---
title: Отладка
description: Руководство по диагностике проблем, отладке плагинов и исправлению распространенных ошибок при запуске Plugify в среде Metamod.
icon: lucide:bug-play
---

Отладка проблем, связанных с Plugify, может быть сложной, особенно потому, что наши пакеты (модули и плагины) по умолчанию публикуются в режиме **релиза без символов**. Эта страница представляет собой исчерпывающее руководство, которое поможет вам эффективно проводить отладку, будь то устранение неполадок в самом Plugify, плагине или игре, такой как CS2.

## **Сборка с символами**

Для эффективной отладки вам необходим доступ к отладочным символам. Поскольку наши опубликованные пакеты не включают символы, вам потребуется самостоятельно собрать модули или плагины. Вот как это сделать:

1. **Клонируйте репозиторий**: Клонируйте репозиторий Plugify или репозиторий модуля/плагина, который вы хотите отладить.
2. **Сборка в режиме `Debug` или `RelWithDebInfo`**: Настройте сборку так, чтобы она включала отладочные символы.
    - Для проектов CMake используйте флаг `-DCMAKE_BUILD_TYPE=Debug`.
   ```bash
   cmake -DCMAKE_BUILD_TYPE=Debug ..
   cmake --build .
   ```
3. **Используйте отладочную сборку**: Замените релизную версию модуля/плагина на отладочную версию, которую вы только что собрали.

::alert{type="warning" icon="lucide:info"}
Отладочные сборки больше по размеру и медленнее релизных, но они предоставляют необходимые символы для эффективной отладки.
::

## **Отладка CS2 или других игр на Source2**

Plugify часто используется с играми, такими как CS2. Отладка этих игр требует специальных инструментов и конфигураций. Ниже приведены инструкции для Windows и Linux/macOS.

### **Отладка на Windows**

Наиболее эффективным подходом на Windows является использование **Visual Studio 2022** в качестве отладчика.

#### **Шаги по отладке CS2 с помощью Visual Studio**
1. **Откройте исполняемый файл**:
    - В Visual Studio перейдите в `Файл > Открыть > Проект или решение`.
    - Выберите исполняемый файл игры (например, `cs2.exe`).

![Открыть проект или решение](/debugging/open_project_or_solution.png)

2. **Установите аргументы командной строки**:
    - Перейдите в `Проект > Свойства > Отладка`.
    - В поле `Аргументы команды` добавьте все, что вы обычно используете для запуска вашего сервера.

![Установить свойства](/debugging/set_properties.png)

3. **Настройте тип отладчика**:
    - Для кода C++ оставьте тип отладчика **Автоматически**.
    - Для отладки скриптов C# установите тип отладчика **Смешанный (.NET Core + 5)**.

4. **Отключите перенаправление ввода-вывода**:
    - В CS2 есть пользовательская консоль, которая может привести к сбою Visual Studio или повреждению вывода, если включено перенаправление ввода-вывода.
    - Отключите перенаправление ввода-вывода, сняв флажок `Перенаправить вывод` в настройках отладки.

5. **Запустите отладчик**:
    - Начните отладку, нажав `F5`.
    - Если произойдет сбой, Visual Studio предоставит подробную информацию, включая трассировку стека и состояния переменных.

![Запустить exe](/debugging/run_exe.png)

::alert{type="info" icon="lucide:info"}
Отладка с символами значительно улучшает качество трассировок стека и убирает обфускацию из имен функций.
::

### **Отладка на Linux/macOS**

На Linux и macOS для отладки можно использовать **GDB** или **LLDB**. Хотя эти инструменты можно использовать извне, их интеграция с IDE обеспечивает лучший опыт отладки.

#### **Использование GDB/LLDB извне**
1. **Запустите игру с GDB/LLDB**:
   ```bash
   gdb ./cs2
   ```
   или
   ```bash
   lldb ./cs2
   ```

2. **Установите точки останова и запустите**:
    - Установите точки останова с помощью `break <имя_функции>`.
    - Запустите игру с помощью `run`.

3. **Исследуйте сбои**:
    - Если игра падает, используйте `bt` (backtrace) для исследования трассировки стека.

#### **Использование IDE**
- **Visual Studio (через Wine)**: Запустите Visual Studio с помощью Wine для привычного опыта отладки.
- **CLion**: Используйте CLion с нативной поддержкой отладки для Linux. CLion интегрируется с GDB/LLDB для бесшовного опыта отладки.

::alert{type="warning" icon="lucide:info"}
Если вы запускаете игру в контейнере Docker, обратите внимание, что Docker не поддерживает LLDB. В этом случае вы должны использовать GDB.
::

## **Отладка Plugify и плагинов**

Большинство проблем, с которыми вы столкнетесь, скорее всего, будут связаны с плагинами или языковыми модулями, а не с самим Plugify. Вот как отлаживать эти компоненты:

1. **Сборка с отладочными символами**: Как уже упоминалось, соберите плагин или языковой модуль в режиме отладки.
2. **Установите точки останова**: Используйте ваш отладчик, чтобы установить точки останова в коде плагина или модуля.
3. **Проверьте логи**: Plugify предоставляет подробные логи, которые могут помочь выявить проблемы. При необходимости включите подробное логирование.
4. **Воспроизведите проблему**: Запустите игру или приложение с подключенным отладчиком, чтобы воспроизвести проблему.

## **Типичные сценарии отладки**

### **1. Сбои в плагинах**
- **Причина**: Неверный доступ к памяти, нулевые указатели или необработанные исключения.
- **Решение**: Используйте отладчик для исследования трассировки стека и выявления проблемного кода.

### **2. Проблемы с производительностью**
- **Причина**: Неэффективный код или утечки ресурсов.
- **Решение**: Используйте инструменты профилирования (например, Valgrind на Linux) для выявления узких мест.

### **3. Проблемы с межъязыковым взаимодействием**
- **Причина**: Неправильное преобразование типов или маршалинг.
- **Решение**: Убедитесь, что экспортируемые функции и их параметры определены и обрабатываются правильно.

## **Советы для эффективной отладки**
- **Включите подробное логирование**: Логи Plugify могут предоставить ценную информацию о том, что происходит «под капотом».
- **Используйте точки останова стратегически**: Устанавливайте точки останова в критических областях вашего кода для исследования состояний переменных и потока выполнения.
- **Воспроизведите проблему**: Постарайтесь изолировать проблему, создав минимальный воспроизводимый пример.
- **Просите о помощи**: Если вы застряли, обратитесь к сообществу в [Discord](https://discord.gg/untrustedmodders) или создайте issue на GitHub.

## **Заключение**

Отладка проблем, связанных с Plugify, требует сборки модулей и плагинов с отладочными символами и использования правильных инструментов для вашей платформы. На Windows Visual Studio является самым эффективным отладчиком, в то время как на Linux/macOS инструментами выбора являются GDB или LLDB. Следуя шагам и советам, изложенным в этом руководстве, вы сможете эффективно диагностировать и решать проблемы в Plugify, плагинах или играх, таких как CS2.